<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Town of Shadows - Game Trial</title>
<style>
  body { background:#0b0b0d; color:#eee; font-family:Inter, Arial; margin:0; }
  .topbar { position:fixed; top:0; left:0; right:0; background:#0f1720; color:#fff; padding:10px 12px; z-index:60; display:flex; align-items:center; justify-content:space-between; }
  .left { display:flex; flex-direction:column; }
  .phaseLabel { font-weight:600; }
  .phaseBar { height:8px; background:#111827; border-radius:6px; overflow:hidden; margin-top:8px; width:320px; }
  .phaseFill { height:100%; width:0%; transition: width 1s linear; background:linear-gradient(90deg,#f59e0b,#f97316); }
  .rulesBtn { background:#111827; color:#f3f4f6; border:1px solid #374151; padding:8px 10px; border-radius:8px; cursor:pointer; }
  .container { padding:100px 12px 20px; max-width:1100px; margin:auto; }
  #playerGrid { display:grid; grid-template-columns: repeat(5, 1fr); gap:8px; }
  .player { background:#0b1220; padding:10px; border-radius:10px; text-align:center; cursor:pointer; color:#e6edf3; border:1px solid #1f2937; }
  .player.dead { opacity:0.35; text-decoration:line-through; }
  .roleLabel { display:block; font-size:12px; color:#9ae6b4; margin-top:6px; font-weight:600; }
  #votePanel { margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .voteBtn { background:#111827; border:1px solid #374151; color:#fff; padding:8px 10px; border-radius:8px; cursor:pointer; }
  #chatBox { background:#071019; height:180px; overflow:auto; padding:8px; border-radius:10px; border:1px solid #0b1220; margin-top:12px; }
  input[type=text] { padding:8px; border-radius:8px; border:1px solid #1f2937; background:#031220; color:#fff; width:200px; }
  button { padding:8px 10px; border-radius:8px; background:#0b1220; color:#fff; border:1px solid #1f2937; cursor:pointer; }
  .selected { outline:3px solid #f97316; }
  .modal { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(2,6,23,0.6); display:flex; align-items:center; justify-content:center; z-index:100; }
  .modalContent { background:#020617; padding:18px; border-radius:10px; width:90%; max-width:720px; max-height:80vh; overflow:auto; border:1px solid #263044; }
  .small { font-size:13px; color:#cbd5e1; }
  @media (max-width:700px){ #playerGrid{grid-template-columns:repeat(4,1fr);} .phaseBar{width:220px;} }
</style>
</head>
<body>
  <div class="topbar">
    <div class="left">
      <div class="phaseLabel" id="phaseLabel">Phase: —</div>
      <div class="phaseBar"><div id="phaseFill" class="phaseFill"></div></div>
    </div>
    <div style="display:flex;gap:10px;align-items:center;">
      <button class="rulesBtn" onclick="openRules()">Rules</button>
      <div id="statusLine">Not connected</div>
    </div>
  </div>

  <div class="container">
    <div id="connect">
      <input id="playerName" placeholder="Your name" />
      <input id="roomId" placeholder="Room ID (leave blank to create)" />
      <button onclick="createOrJoin()">Create / Join</button>
      <button onclick="startGame()">Start Game</button>
    </div>

    <div id="gameArea" style="display:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div><strong id="lobbyLabel">Lobby</strong></div>
        <div><button onclick="startGame()">Start Game</button></div>
      </div>

      <div id="playerGrid"></div>

      <div id="votePanel" style="display:none;">
        <div id="voteControls">
          <button class="voteBtn" onclick="castVote('skip')" id="skipBtn">Skip</button>
          <button class="voteBtn" onclick="confirmVote()" id="confirmBtn">Confirm Vote</button>
          <button class="voteBtn" onclick="changeVote()" id="changeBtn">Change Vote</button>
        </div>
        <div id="voteMsg" style="margin-left:10px;color:#cbd5e1;"></div>
      </div>

      <div id="chatBox"></div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center;">
        <input id="chatInput" type="text" placeholder="Type message or number to vote..." />
        <button onclick="sendChat()">Send</button>
      </div>
    </div>
  </div>

  <div id="rulesModal" class="modal" style="display:none;">
    <div class="modalContent">
      <h3>Town of Shadows — Rules</h3>
      <div class="small">
        <p><strong>Objective</strong>: Town wins by eliminating all Mafia. Citizens don't need to eliminate Cult or Neutrals.</p>
        <p><strong>Phases</strong>: Night (40s) → Day discussion (60s) → Vote (20s) → Defence (10s) → Final verdict (10s).</p>
        <p><strong>Roles</strong>: Mafia (Godfather, Mafioso, Spy, Beastman...), Town (Doctor, Detective, Bodyguard...), Cult (Leader, Fanatic...), Neutrals (Jester, Executioner...)</p>
        <p><strong>Doctor</strong>: Can heal any player multiple nights. Heals prevent death but not cult conversion. Beastman ignores heal.</p>
        <p><strong>Vigilante</strong>: Can only successfully shoot if the target is Mafia (including culted mafia); otherwise shot fails.</p>
        <p><strong>Spy</strong>: Mafia's spy who must contact to reveal some powers; follows contact rules like Fanatic.</p>
        <p>... (full role descriptions included in final build)</p>
      </div>
      <div style="text-align:right;margin-top:10px;"><button onclick="closeRules()">Close</button></div>
    </div>
  </div>

<script src="wsClient.js"></script>
</body>
</html>
