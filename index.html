<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Town of Shadows</title>
  <style>
    body {
      background-color: #0c0c0c;
      color: #e0e0e0;
      font-family: "Poppins", sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    #game {
      max-width: 900px;
      margin: auto;
      padding: 10px;
    }
    #playerGrid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
      margin-top: 15px;
    }
    .player {
      background-color: #222;
      border-radius: 8px;
      padding: 8px;
      font-size: 13px;
    }
    .dead { opacity: 0.4; }
    #chatBox {
      background: #111;
      height: 180px;
      overflow-y: auto;
      padding: 5px;
      border: 1px solid #333;
      margin: 10px auto;
      width: 95%;
      text-align: left;
      font-size: 13px;
    }
    #controls {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 10px;
    }
    button {
      background: #333;
      color: #eee;
      border: none;
      border-radius: 5px;
      padding: 8px 12px;
      cursor: pointer;
    }
    #tutorialPopup, #rulesPopup {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: #151515;
      border: 2px solid #666;
      border-radius: 10px;
      width: 80%;
      max-width: 480px;
      height: 70%;
      overflow-y: auto;
      z-index: 1000;
      color: #f0f0f0;
      padding: 15px;
      text-align: left;
    }
    .closeBtn {
      position: absolute;
      top: 5px;
      right: 10px;
      cursor: pointer;
      color: #ff7070;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="game">
    <h1>üèôÔ∏è Town of Shadows</h1>

    <div id="connect">
      <input id="roomId" placeholder="Room ID" />
      <input id="playerName" placeholder="Your Name" />
      <button onclick="createRoom()">Create Room</button>
      <button onclick="joinRoom()">Join Room</button>
    </div>

    <div id="gameplay" style="display:none;">
      <h3 id="statusText"></h3>
      <div id="phaseText"></div>
      <div id="playerGrid"></div>

      <div id="controls">
        <button onclick="startGame()">Start Game</button>
        <button onclick="showRules()">Rules</button>
      </div>

      <div id="chatBox"></div>
      <input id="chatInput" placeholder="Type message..." onkeydown="if(event.key==='Enter')sendChat();" />
      <button onclick="sendChat()">Send</button>
    </div>
  </div>

  <!-- Tutorial popup -->
  <div id="tutorialPopup">
    <div class="closeBtn" onclick="closeTutorial()">‚úñ</div>
    <h3>Welcome to Town of Shadows!</h3>
    <p>This is a strategic social deduction game between the Town, Mafia, and Cult factions. 
    At night, players use their skills (heal, kill, protect, convert, etc). 
    During the day, everyone discusses and votes to eliminate suspects.</p>
    <p>Use logic and teamwork to uncover the truth. 
    If you‚Äôre Mafia or Cult, coordinate secretly to take over the town.</p>
    <p><b>Good luck!</b></p>
    <button onclick="closeTutorial()">Got it!</button>
  </div>

  <!-- Rules popup -->
  <div id="rulesPopup">
    <div class="closeBtn" onclick="closeRules()">‚úñ</div>
    <h2>üìú Game Rules & Roles</h2>
    <p><b>Objective:</b> Each faction wins by eliminating all others.</p>
    <ul>
      <li><b>Town:</b> Find and eliminate all Mafia. Cult doesn‚Äôt stop your win.</li>
      <li><b>Mafia:</b> Eliminate the Town. You win if only Mafia remain or equal Cult count.</li>
      <li><b>Cult:</b> Recruit others to your side until you dominate the town.</li>
      <li><b>Doctor:</b> Heal one target each night (can self-heal). Prevents death except from Beastman.</li>
      <li><b>Vigilante:</b> May shoot Mafia; fails if shooting non-Mafia.</li>
      <li><b>Spy:</b> Can contact Mafia or learn a target‚Äôs role if non-Mafia.</li>
      <li><b>Fanatic:</b> Becomes linked to Cult after contact; visible only after that.</li>
      <li><b>Beastman:</b> Contacts to awaken; their attacks ignore Doctor/Bodyguard protection.</li>
    </ul>
    <p>Day/Night Cycle:</p>
    <ul>
      <li>Night 1 starts immediately.</li>
      <li>Night = 40s for skills and faction chat.</li>
      <li>Day discussion = 60s, then 20s voting, 10s defence, 10s verdict.</li>
    </ul>
    <p>Use chat to accuse, discuss, and vote (type player number to vote).</p>
    <p>Click "Got it!" on tutorial to start playing.</p>
  </div>

  <script src="wsClient.js"></script>
</body>
</html>
